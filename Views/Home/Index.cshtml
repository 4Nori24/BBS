@model List<BBSWebApp.Models.SentenceClass>
@{
    ViewData["Title"] = "Home Page";
    var selectedId = ViewBag.SelectedId as int?;
}

<link rel="stylesheet" href="~/css/site.css" />

<button type="button" id="btnSearch" class="btn btn-outline-secondary mb-3">
    🔍 検索
</button>

<!-- 検索条件 -->
<form method="get" asp-controller="Home" asp-action="Index" id="search-condition" class="mb-4">

    <div class="row g-2 mb-3">
        <div class="col-md-6">
            <label class="form-label">タイトル</label>
            <input type="text" name="txtTitle" class="form-control" />
        </div>
        <div class="col-md-6">
            <label class="form-label">カテゴリー</label>
            <select name="txtCategory" class="form-control">
                <option value="">選択してください</option>
                <option value="つぶやき">つぶやき</option>
                <option value="悩み">悩み</option>
                <option value="本のススメ">本のススメ</option>
                <option value="その他">その他</option>
            </select>
        </div>
    </div>
    <div class="row g-2 align-items-end">
        <div class="col">
            <label class="form-label">投稿日</label>
            <input type="text" name="txtDateFrom" class="form-control" />
        </div>
        <div class="col-auto">～</div>
        <div class="col">
            <input type="text" name="txtDateTo" class="form-control" />
        </div>
        <div class="col-auto">
            <button type="submit" name="submitAction" value="search" class="btn btn-primary">検索</button>
        </div>
    </div>
</form>

<!-- 投稿一覧 -->
<div class="d-flex justify-content-center">
    <form method="post" asp-controller="Home" asp-action="Index" class="p-4 border rounded shadow-sm bg-light w-100" style="max-width: 1140px;">
        @if (Model?.Count > 0)
        {
            <div class="post-list overflow-auto">
                @foreach (var item in Model)
                {
                    var isSelected = selectedId.HasValue && item.PostNo == selectedId.Value;
                    var cardClass = isSelected ? "post-card selected mb-3" : "post-card mb-3";
                    var replyId = $"replyCard_{item.PostNo}";

                    <div class="@cardClass">
                        <div class="post-meta text-muted small">
                            <span class="meta-item">@item.Contributor</span>
                            <span class="meta-item">@item.Date</span>
                            <span class="meta-item">@item.Category</span>
                            <span class="meta-item">@item.Title</span>
                        </div>

                        <div class="post-content mt-2"><p class="mb-0">@item.Content</p></div>
                        <button type="submit" name="action" value="commentView" @* class="btn btn-primary" *@ onclick="setSelectedPostNo(@item.PostNo)">💬</button>
                    </div>

                    <div id="@replyId" class="replycardClass mt-2">
                        <textarea id="txtReply" name="txtReply" class="form-control mb-2"></textarea>
                        <button type="submit" name="action" value="reply" class="btn btn-secondary">投稿</button>
                    </div>
                }
            </div>
        }
        else
        {
            <p>該当する投稿はありません。</p>
        }

        <!-- Hidden field for 選択された投稿番号 -->
        <input type="hidden" id="selectedPostNo" name="selectedPostNo" />

        <!-- 操作ボタン -->
        <div class="d-flex justify-content-between mt-3">
            <button type="submit" name="action" value="new" class="fixed_btn">＋</button>
            <button type="button" class="home_btn">🏠</button>
        </div>
    </form>
</div>

<script>
    function setSelectedPostNo(postNo) {
        document.getElementById("selectedPostNo").value = postNo;
    }

    document.addEventListener("DOMContentLoaded", function () {
        const btnSearch = document.getElementById("btnSearch");
        const searchCondition = document.getElementById("search-condition");

        if (btnSearch && searchCondition) {
            btnSearch.addEventListener("click", function () {
                searchCondition.classList.toggle("show");
            });
        }
    });

</script>